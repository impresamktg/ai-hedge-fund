
<!DOCTYPE html>
<html>
<head>
    <title>AI Hedge Fund</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">AI Hedge Fund Analysis</h1>
        
        <div class="card mb-4">
            <div class="card-body">
                <form id="analysisForm">
                    <div class="mb-3">
                        <label class="form-label">Stock Tickers (comma-separated)</label>
                        <input type="text" class="form-control" id="tickers" placeholder="AAPL,MSFT,GOOGL" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Date Range</label>
                        <div class="row">
                            <div class="col">
                                <input type="date" class="form-control" id="startDate" required>
                            </div>
                            <div class="col">
                                <input type="date" class="form-control" id="endDate" required>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Initial Capital</label>
                        <input type="number" class="form-control" id="initialCapital" value="100000">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Select AI Analysts</label>
                        <div id="analysts">
                            {% for analyst in analysts %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="{{ analyst.value }}" id="{{ analyst.value }}">
                                <label class="form-check-label" for="{{ analyst.value }}">
                                    {{ analyst.display }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Select LLM Model</label>
                        <select class="form-select" id="model">
                            {% for model in models %}
                            <option value="{{ model.value }}">{{ model.display }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary" onclick="runAnalysis()">Analyze</button>
                        <button type="button" class="btn btn-secondary" onclick="runBacktest()">Run Backtest</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="results" class="card mb-4 d-none">
            <div class="card-body">
                <h3>Analysis Results</h3>
                <div id="resultsContent"></div>
                <div id="plot"></div>
            </div>
        </div>
    </div>

    <script>
        // Set default dates
        document.getElementById('endDate').valueAsDate = new Date();
        let startDate = new Date();
        startDate.setMonth(startDate.getMonth() - 3);
        document.getElementById('startDate').valueAsDate = startDate;

        function getFormData() {
            return {
                tickers: document.getElementById('tickers').value,
                start_date: document.getElementById('startDate').value,
                end_date: document.getElementById('endDate').value,
                initial_capital: document.getElementById('initialCapital').value,
                analysts: Array.from(document.querySelectorAll('#analysts input:checked')).map(cb => cb.value),
                model: document.getElementById('model').value
            };
        }

        async function runAnalysis() {
            const data = getFormData();
            const response = await fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            displayResults(result);
        }

        async function runBacktest() {
            const data = getFormData();
            const response = await fetch('/backtest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            displayBacktestResults(result);
        }

        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            const content = document.getElementById('resultsContent');
            resultsDiv.classList.remove('d-none');
            
            let html = '<div class="table-responsive"><table class="table">';
            html += '<thead><tr><th>Ticker</th><th>Action</th><th>Quantity</th><th>Confidence</th></tr></thead><tbody>';
            
            for (const [ticker, decision] of Object.entries(result.decisions)) {
                html += `<tr>
                    <td>${ticker}</td>
                    <td>${decision.action}</td>
                    <td>${decision.quantity}</td>
                    <td>${decision.confidence}%</td>
                </tr>`;
            }
            
            html += '</tbody></table></div>';
            content.innerHTML = html;
        }

        function displayBacktestResults(result) {
            const resultsDiv = document.getElementById('results');
            const content = document.getElementById('resultsContent');
            resultsDiv.classList.remove('d-none');
            
            let html = '<div class="table-responsive"><table class="table">';
            html += '<thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody>';
            
            for (const [metric, value] of Object.entries(result)) {
                html += `<tr><td>${metric}</td><td>${value}</td></tr>`;
            }
            
            html += '</tbody></table></div>';
            content.innerHTML = html;

            // Create plot if data available
            if (result.portfolio_values) {
                const trace = {
                    x: result.portfolio_values.map(d => d.Date),
                    y: result.portfolio_values.map(d => d.Value),
                    type: 'scatter'
                };
                Plotly.newPlot('plot', [trace], {
                    title: 'Portfolio Value Over Time'
                });
            }
        }
    </script>
</body>
</html>
